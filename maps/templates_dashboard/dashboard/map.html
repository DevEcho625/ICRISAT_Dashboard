<!DOCTYPE html>
<html>
<head>
    <title>ICRISAT Field Dashboard</title>

    <!-- Leaflet CSS -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100vw;
        }

        #info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            width: 260px;
            z-index: 1000;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div id="info">
    <h3>Field Data</h3>
    <p>Click a field</p>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Initialize map centered on requested coordinates
    var map = L.map('map').setView([17.506988, 78.275083], 16);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
    }).addTo(map);

    // Field polygons
    var fields = [
        {
            id: 1,
            coords: [
    [17.509585, 78.274073], // top-right
    [17.509440, 78.271193], // top-left
    [17.507621, 78.271265], // bottom-left
    [17.507740, 78.274197]  // bottom-right
]

        }
    ];

    fields.forEach(field => {
        var polygon = L.polygon(field.coords, {
            color: 'green',
            fillOpacity: 0.5
        }).addTo(map);

        polygon.on('click', function () {
            fetch(`/dashboard/field/${field.id}/`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('info').innerHTML = `
                        <h3>Field ${data.field_id}</h3>
                        <b>Crop:</b> ${data.crop}<br>
                        <b>Last Sown:</b> ${data.last_sown}<br>
                        <b>Last Fertilized:</b> ${data.last_fertilized}<br>
                        <b>Soil Moisture:</b> ${data.soil_moisture}<br>
                        <b>Nitrogen:</b> ${data.nitrogen_level}<br>
                        <b>Expected Yield:</b> ${data.expected_yield}
                    `;
                });
        });
    });
</script>

</body>
</html>
